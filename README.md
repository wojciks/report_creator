# report_creator
No more txt noon reports! Just configure excel file access and fill in nav data once!

You can find instructions how to configure/use the app down below.

## Purpose
This program is developed to help navigators with their daily reporting routine.

## Another useless reporting tool?
One of the biggest burdens of navigational officers nowadays is reporting. Just after taking over noon  watch a nightmare of copying and pasting of various data takes place to satisfy -sometimes very strange - report requirements of various parties.

Usually  data is being read from some sort of excel file generated by engineers regarding fuel consumption and performance of various machinery in Engine Room. Then this data is being copied and pasted to numerous text file based reports to be sent to different interested parties, like owners, charterers, weather services etc. For keyboard skilled navigator this takes usually more or less half an hour. Half an hour that ship sails without too much navigational supervision. That means heightened risk of collision or other incident related to the ship movement. Not to mention getting the wrong data copied to the wrong place in report and causing cascade of uneasy questions to the captain.

## Libraries used:
+ `xlrd` for reading excel files,
+ `sqlite3` for database operations,
+ `json` for config file processing,
+ `PySimpleGUI` for GUI.


## Features already implemented
+ report_creator access excel file and reads data and saves it to text files, according to configuration variables to be edited by the user. It can fill up multiple text files in one go!
+ Database integration, so to perform operations on past data.
+ Basic navigation calculations based on user entry (avg speed from last event, Beaufort scale winds).
+ Config file is in JSON format, data row/column source in excel being updated if user is happy with reports. BUT... (see JSON entry in "Known Issues").
+ Simple, NOT 'idiotproof' GUI made in `PySimpleGUI`

## Future features:
+ Number format for Engine data
+ Navigation calculations: total voyage time, currents, LT, voyage distances and average speeds (this is a priority).
+ Dedicated report generation: for a part of the voyage between two separate event of user's choice (this is a priority).
+ Data validation - just in case someone will put this additional zero in the wrong place!
+ GUI to be made 'idiotproof', so it will not accept wrong inputs. 
+ ~~Executable format, so on ships without possibility of installing python interpreter, software still can be used.~~ (It is accomplished by `pyinstaller` but needs to be investigated further to avoid compatibility and security issues within Windows(TM) systems)

## Going further:
+ Filling up inconvenient HTML forms sometimes companies use to generate reports in format that is convenient for them, (**This can be achieved by editing the source of html file.**) or mimicking functionality of these forms.
+ Specialised reports in different formats to answer growing needs of companies (PDF, CSV, XLS, and others).
+ Additional features, like graphically showing relative wind direction and other

## Known issues:
+ **THE CODE.** It is still a very early development stage and app needs plenty of refactoring.
+ **JSON** After iterating the first row/column for data to be read from, al formatting in `appconf.json` is lost. It's due to JSON format not supporting multi-line entries. Workaround would be nice, but file is still usable and human-readable, but not convenient at all.
+ Painful initial config (it will still be worth wile, if the app is going to work with its full potential.
+ Strict number format rules - otherwise app is going to crash.
+ Database consists only one table. More tables should be used so more features could be implemented. 
+ Multi-line field "Remarks:" in `Nav info` tab should update itself according to last database entry. The problem is the new line character `\n` which is literally put in the field. For now, this field will not update from database.
+ Latitude / longitude hemispheres as a choice in drop-down list does not allow to get a default value from database's last entry.
+ What if there will be more types of fuel? Or more sludge tanks to take into account?

# Instructions for use:
## File descriptions:
App comes with some sample files, already being configured to work with each other:
+ `./excel/Daily report.xlsx`is a sample file with data for engine. This is only one format of excel file prepared by chief engineer.
+ `./reps_example` is a folder containing three examples of reports, already filled out to serve as templates for the app
+ `./appconf.json` is a config file containing all the file paths and excel file reading configuration
+ `./gui.py` is a main file to run the app.

##Configuration and first steps:
Copy the app to location of your choice.

Open `./appconf.json` file:

Those lines are pretty self-explanatory:

`"EXCEL_PATH": "./excel/Daily report.xlsx",` state, where is excel file you want to use. Under Windows be sure to use double backslash `\\` instead of single one.  
`"EXCEL_SHEET": "Sheet1",` name of the sheet containing data.  
`"DATA_GOING_DOWN": true,` true if data is chronology of data is arranged vertically (next events are in consecutive rows), false - if horizontally (next events are in consecutive columns)  
`"FIRST_DATA": 722,` number of row/column from the sheet to be treated as a first event. 

`"TEMPLATE_DIRECTORY": "./reps_example/",` location of reports templates' files  
`"REPORT_OUTPUT_DIRECTORY": "./reps_output",` location, where the output files (filled out reports) will be created.

Next rows in `appconf.json` file are to specify  where the app should look for particular data. Those are the numbers of rows/columns. If you put a number `0`, the app will not look for the the data.


Following abbreviations are created to be as intuitive as possible, but just in case, here are the meanings of all of them:
  
`HFOROB` Heavy Fuel Oil right on board,  
`MDOROB` Marine Diesel Oil right on board,  
`LOCYLROB` Lube Oil for cylinders right on board,  
`LOMEROB` Lube Oil for main engine right on board,  
`LOAUXROB` Lube Oil for auxiliary engines right on board,  
`LOTOTALROB` Lube Oil total amount on board,  
`FWROB` Fresh Water right on board,  
`FWPROD` Fresh Water production,  
`FWCONS` Fresh Water consumption,  
`MEHFOCONS` Main engine consumption of Heavy Fuel Oil,  
`MEMDOCONS` Main engine consumption of Marine Diesel Oil,  
`AUXHFOCONS` Auxiliary engine consumption of Heavy Fuel Oil,  
`AUXMDOCONS` Auxiliary engine consumption of Marine Diesel Oil,  
`BOILERHFOCONS` Boiler consumption of Heavy Fuel Oil,  
`BOILERMDOCONS` Boiler consumption of Marine Diesel Oil,  
`TOTALHFOCONS` Total consumption of Heavy Fuel Oil,  
`TOTALMDOCONS` Total consumption of Marine Diesel Oil,  
`LOCYLCONS` Cylinder consumption of Lube Oil,  
`LOMECONS` Main engine consumption of Lube Oil,  
`LOAUXCONS` Auxiliary engine consumption of Lube Oil,  
`TOTALLOCONS` Total consumption of Lube Oil,  
`RPM` Main Engine average RPMs,  
`MEDIST` Main Engine distance,  
`MESPD` Main Engine speed,  
`SLIP` Main Engine slip,  
`MEKW` Average Main Engine output,  
`MEKWH` Total Main Engine output from last event,  
`MELOAD` Main Engine thermal load,  
`MEGOV` Main Engine governor setting,  
`AUXTIME` Auxiliary Engines total working time,  
`AUXKW` Average Auxiliary Engines output,  
`AUXKWH` Total Auxiliary Engines output from last event,  
`SLUDGETK` Amount of contents in sludge tank,  
`OILYBILGETK` Amount of contents in oily bilge tank,  
`INCINERATORSETTLINGTK` Amount of contents in incinerator settling tank,  
`INCINERATORSERVICETK` Amount of contents in incinerator service tank,  
`BILGEWATERTK` Amount of contents in bilge water tank,  
`SLUDGETOTAL` Total amount of sludge.

This is already set for the presented excel file.

**It is a great idea to backup this file, as after first report creation the formatting of the file will be lost!**

Now it is time to prepare the text files for templates. These should be copied as per path specified in `appconf.json`, and edited appropriately. The data required to be put in the file will replace the tags defining that data. Data is stored in huge dictionary and - apart from above abbreviations, that should be put between `~`, consists of following entries:

`~VOY~` number/name of the present voyage,  
`~EVENT~` event of the voyage, like noon, arrival, departure, Beginning/End of Sea Passage (BOSP/EOSP) etc.  
`~LOCATION~` like Sea or name of port,  
`~TIMELOCAL~` Local time,  
`~TZ~` Time Zone **(+ for East of Grenweech, - fo West),  
`~TIMEUTC~` UTC time,  
`~LAT~`, `~LON~` latitude and longitude,  
`~COURSE~` course,  
`~GPSDIST~` distance made good from last event,  
`~TIMEFROMLAST~` time elapsed from last event,  
`~GPSAVGSPD~` average speed over ground,  
`~REMAININGDIST~` remaining distance to destination,  
`~LOGFROMLAST~` log (water) distance from last event,  
`~LOGSPDLAST~` average speed through the water,  
`~CURRENTSPD~` speed of current,  
`~ANCHORDROPPED~` date/time of dropping anchor **(not used at the moment)**,  
`~ANCHORAWEIGH~` date/time of heaving up anchor **(not used at the moment)**,  
`~NEXTPORT~` name of port of destination,  
`~ETATIMELOCAL~` Estimated Time of Arrival at port of destination (local time),  
`~ETATZ~` time zone of port of destination,  
`~ETATIMEUTC~` Estimated Time of Arrival at port of destination (UTC),  
`~WINDDIR~` wind direction,  
`~WINDFORCEKTS~` wind force in knots,  
`~WINDFORCEB~` wind force in Beaufort scale,  
`~SEAHEIGHT~` height of waves in meters,  
`~SEADIR~` sea direction,  
`~SWELL~` swell height in meters,
`~AIRTEMP~` air temperature,  
`~PRESSURE~` air pressure,  
`~BILGES~` if bilges are dry or not,  
`~REMARKS~` remarks;)  
`~MASTER~` name of master,  
`~VOYDIST~` voyage distance,  
`~VOYTIME~` voyage time,  
`~VOYGPSAVGSPD~` voyage average speed,  
`~VOYLOGDIST~` voyage log (water) distance,  
`~IFCARGO~` are the cargo operations in progress?  
`~COMMENCECARGOUTC~` time of cargo operations commencement (UTC),  
`~COMPLETEDCARGOUTC~` time of cargo operations completion (UTC),  
`~CARGOROB~` cargo on board,  
`~CARGODAILY~` cargo loaded/discharged from last event,  
`~CARGOTOGO~` cargo remaining to be loaded (or already discharged),    
`~BALLASTROB~` amount of ballast water on board,  
`~BALLASTDAILY~` ballast pumped in/out since last event,
`~SHORECRANESNO~` how many shore cranes were engaged in cargo operations since last event,  
`~SHIPCRANESNO~` how many ship cranes were engaged in cargo operations since last event,  
`~ETCLOCAL~` Estimated Time Completion (local time)
`~ETDLOCAL~` Estimated Time Departure (local time)

After editing the files, the app is ready to go. Launch `gui.py` or appropriate executable, if you're using portable version.

After launch you will see main window of the app. Mandatory data should be entered, otherwise you will not be able to proceed, Date/Time fields are defaulting to system date and time.

**Before hitting calculate button you MUST enter "Time from last event", or the app will crash! The format of input in this field is HH:mm**

You should also type in "Remaining distance" field with initial route distance. Otherwise app will not calculate real ETA and required speed for given ETA. 

After finishing `Nav info` Tab, you should go to `Engine info` and see, i everthing is ok there **(actually you should do it straight after first launch, so not to waste time for data input if config is bad)**. Data here is imported from excel file. Fill up `Cargo info` tab as necessary.

After clicking `Submit` button, you will be asked about data validity and to confirm database update/creation. If you hit `No`, you will be able to modify the entry. Hitting `Yes` will create database file `./data_history.db` and update first record with all the data from app. You will see confirmation of that and information about going to next row/column of data in excel file. Be warn though, that the data in the app is not updated with the next row/column contents! Also from now on you are not able to edit any data for saved entry. But you still able to create reports! Just hit `Create reports` button and check destination folder you have specified in `appconf.json`. New files' names are being created from today's date and template file names.

Next time you open app, you will see some of the fields already filled up - these entries are being taken from last record in database. **You should not fill out the field "Time form las event", as it will be calculated for you.** Same goes for remaining distance. You still can edit these fields (as all the others) at any time, if that is necessary. Just remember, that after clicking `Submit` button, database will not be updated.